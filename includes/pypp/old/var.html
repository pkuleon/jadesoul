<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Consolas';
	font-size: 14pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	font-family: 'Consolas';
	color: #008000;
}
.sc2 {
	font-family: 'Consolas';
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 2; background: #FFFFFF; "><span class="sc9">#define debug
#include &lt;jade.hpp&gt;
#include &lt;typeinfo&gt;
</span><span class="sc0">
</span><span class="sc9">#define showt(tmp) cout&lt;&lt;typeid(tmp).name()&lt;&lt;endl
#define showp(p) cout&lt;&lt;p&lt;&lt;endl
#define msg(s) cout&lt;&lt;#s&lt;&lt;endl
</span><span class="sc0">

</span><span class="sc2">// #define dbg(msg) cout&lt;&lt;"creating a new var: "&lt;&lt;#msg&lt;&lt;" : "&lt;&lt;r&lt;&lt;" : "&lt;&lt;this&lt;&lt;endl
</span><span class="sc9">#define dbg(msg)
</span><span class="sc0">
</span><span class="sc2">// #define codemask(...) __VA_ARGS__
</span><span class="sc9">#define codemask(...)
</span><span class="sc0">
</span><span class="sc2">// typedef vector&lt;var&gt; list;
</span><span class="sc0">
</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">pypp</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">



</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">vt</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">  </span><span class="sc2">//to store the types of a var
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">base</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">undef</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">//sorry, we don't know
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">number</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">//int or short or float
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">//stl string or c-string
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">//boolean type
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">object</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">//for object
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">=</span><span class="sc11">end</span><span class="sc10">-</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">//no use
</span><span class="sc0">        </span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//all number types
</span><span class="sc0">                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">base</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">real4</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">real8</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">=</span><span class="sc11">end</span><span class="sc10">-</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">base</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">cstr</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">=</span><span class="sc11">end</span><span class="sc10">-</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">base</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc11">base</span><span class="sc10">+</span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">=</span><span class="sc11">end</span><span class="sc10">-</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">veryend</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc2">//21
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc2">// 旨在构造一种统一类型，可以包装各种基本类型和类类型，通过在构造时记录包装的类型，在共有操作时
// 自动选择相应类型的合理操作，另外，还可以给各种基本类型增加方法，增强其功能，或是对复杂类类型做API代理
// 实现更友好方便的容器、序列操作接口,再次，实现C++本身不提供但应用需要的各种方便的基本序列操作方法
// 如print, split, replace等，也在内部使用迭代器以达到高性能，同时提供各种遍历接口
</span><span class="sc0">
</span><span class="sc2">// var的思想部分类似jquery对DOM的各种类型封装，统一接口
// 统一类型使得基本的容器类型的特性可以得到充分利用
</span><span class="sc0">
</span><span class="sc2">// 对于临时基本类型，var将它的副本保存在自己的对象内存区内，对于非临时的基本类型，则仅保留其指针
// 对于更加复杂的类类型如string和vector，由于其大小未知且可变，不可能都拷贝副本到var内部
// 因此var无法处理复杂类型的临时对象, 必须先定义，再将引用或指针传给var构造函数
// 对于这些非临时复杂类型，var可以根据传入的其引用记录其指针，或直接记录传入的指针，已达到对象封装
</span><span class="sc0">
</span><span class="sc2">// var并不是通过多态来实现类型统一的，使用多态也可以实现类型统一，
// 但在最终操作时还是需要知道类型才能做不同子类的相异方法。且在使用时，每次都得定义基类的指针，
// 指向子类的对象,不是很方便，动态对象还得一个个去负责内存释放，可能需要一种更好的堆自动内存管理方式。
// 或许可以去研究一下placement new重载，和动态内存池管理
</span><span class="sc0">
</span><span class="sc2">// var使用起来就像一种基本数据类型，像int一样，但是又有非常多的成员函数，功能丰富
// 成员函数的名字都尽量简短，像jquery和python那样
// 需要注意的是，var并不是模板类，模板类在静态编译期间对类型要求严格，解引用的时候必须知道类型
// 如果是模板类，就算使用模板类也不能实现一个vector里面装不同的对象类型
// 因此var只能对有限的类型封装，对支持的类都需要手动编写一堆构造函数和相关操作函数
// var的目标是保证性能不会下降很多的情况下极大提升C++的易用性，因此只会对基本内置类型和
// 几个常用的复杂类型封装，它们都是平时使用频率最高的，如果更进一步精简，
// 完全可以把char, short, int, long long都看做number类型，把string, char都看做str类型
// 可以用宏来减少体力劳动，也应当设计机制实现对于新复杂类型的插件式支持
</span><span class="sc0">
</span><span class="sc2">// 对于getter器和setter器，借鉴jqury的val函数的思想,仅用一个函数实现，用传值与不传值(默认参数)加以区分
</span><span class="sc0">
</span><span class="sc2">// 实现了一种局部对象的内存管理机制，即根据一个从一个函数中返回一个临时对象的引用时
</span><span class="sc0">        </span><span class="sc2">// 如str&amp; str.replace() {} 
</span><span class="sc0">        </span><span class="sc2">// （返回类型是对象的引用而不是对象的副本可以避免一次临时对象的构造）
// 必须在函数内部构造一个临时str对象，若str s, 在栈中分配一个临时对象,这就导致一个问题
// 临时对象在函数返回后就析构，返回的引用是有问题的，只能在函数中在堆中分配一个对象以解决这个问题
// 但这个对象什么时候被析构其由谁来负责就又成了一个问题
</span><span class="sc0">
</span><span class="sc2">// 设计一个临时对象管理器,内部含有许多stl::list链表, 因为完全不需要随机访问，list能保证插入删除足够快
// 针对每种基本类型，var, list:vector&lt;var&gt;, str:string, tuple:vector&lt;var&gt;, 
// dict:map&lt;var, var&gt;都有一个相应的链表记录所有在var成员函数中临时分配的这种类型的对象
// var有两个静态成员，一个是指向管理器的指针，一个是var类的计数器，当var类第一次被构造时，自动在堆中创建
// 这个全局唯一的临时对象管理器，当var类的最后一个实例被析构时，自动析构临时对象管理器，
// 而临时对象管理器在析构时，会负责析构所有搜集到的指针指向的临时对象
// 只要保证当前作用域中有至少一个var对象，就能保证所有的临时对象不被析构，因此，较好的做法是在main函数中
// 第一行就定义一个var app;或者var root;当main结束时所有的var也该自动析构了
// 注意，var类也可以在堆中创建，这时，var的临时对象管理器中也会记录堆中分配的var的指针
// var的计数器也会加1, 如果这些var等var的计数器到达0才被析构的话，会导致var的计数器总是减不到0，类似死锁
// 解决方法是管理器在记录var的new操作的时候计数，var的内部计数减去管理器的计数到达0时 ，就析构管理器
// 因此必须禁止手动的delete掉任何new出来的var，任何new的var必须让管理器记录，否则就会导致不一致
// 实现的时候，在管理器的成员函数中封装new var操作，并约定禁止手动执行var的delete, 不要在var类之外new var
</span><span class="sc0">
</span><span class="sc2">// 四种基本常用的复杂类型，list, str, tuple, dict, set，在这里，它们不是通过新定义的类来实现的
// 不是严格的数据类型，与其说是数据类型，不如说它们表达的是四种概念
// vt命名空间是用来var所支持的数据类型var types进行的分类
// 每种类型都有对应的基本类型或者复合类型：
// list也是一个var类型，是var对vector&lt;var&gt;的封装
// str则是var对string的封装
// 一个tuple对象也是一个var对象，tuple的行为和list几乎一样，因此只需要定义一个tuple生成函数
// dict是var对stl::map&lt;var, var&gt;的封装，实现任意(var所支持的)类型的键和任意类型的值的键值对
// set就是一个stl::set&lt;var&gt;
</span><span class="sc0">
</span><span class="sc2">// 可能存在的问题有:
</span><span class="sc0">                </span><span class="sc2">// 一个复杂类的对象被var封装后被析构（可能由于其再堆中被delete,或者是在栈中而作用域结束）
</span><span class="sc0">                </span><span class="sc2">// 则var封装的指针失效，无法检测，这种情况只能自己做到心中有数，尽量小心
</span><span class="sc0">                </span><span class="sc2">// 尽量在var封装的复杂对象生命期还有效的作用域内完成对其的操作
</span><span class="sc0">                
                </span><span class="sc2">// var内部不能封装另外一个var
</span><span class="sc0">                </span><span class="sc2">// 如果已知var封装的是一个临时变量的指针，可以调用var.del()删掉，会自动检查指针是否再管理器中
</span><span class="sc0">                </span><span class="sc2">// 如果在也删掉管理器中的指针
</span><span class="sc0">
                </span><span class="sc2">// 完全不支持new []出来的指针的delete []，正好也没有这种需求
// 待处理：
</span><span class="sc0">                </span><span class="sc2">// 把类的声明和实现分开，想办法用宏解决可能重复的内容
</span><span class="sc0">


</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">     </span><span class="sc2">//4+8+4+4=20 bytes total for each var obj
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">vector</span><span class="sc10">&lt;</span><span class="sc11">var</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">//可以将p与union合并，因为当union全部使用的时候，this就是p
</span><span class="sc0">        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc2">//pointer to any type of non-const object, or hold any other kind of pointer
</span><span class="sc0">        </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//pool to hold one const built-in types
</span><span class="sc0">                </span><span class="sc11">sint1</span><span class="sc0"> </span><span class="sc11">si1</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">//char
</span><span class="sc0">                </span><span class="sc11">uint1</span><span class="sc0"> </span><span class="sc11">ui1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">uchar</span><span class="sc0"> </span><span class="sc11">uc</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">sint2</span><span class="sc0"> </span><span class="sc11">si2</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">//short
</span><span class="sc0">                </span><span class="sc11">uint2</span><span class="sc0"> </span><span class="sc11">ui2</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">ushort</span><span class="sc0"> </span><span class="sc11">us</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">sint4</span><span class="sc0"> </span><span class="sc11">si4</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc2">//int
</span><span class="sc0">                </span><span class="sc11">uint4</span><span class="sc0"> </span><span class="sc11">ui4</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">ui</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">sint8</span><span class="sc0"> </span><span class="sc11">si8</span><span class="sc10">;</span><span class="sc0">                                      </span><span class="sc2">//long long
</span><span class="sc0">                </span><span class="sc11">uint8</span><span class="sc0"> </span><span class="sc11">ui8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">real4</span><span class="sc0"> </span><span class="sc11">r4</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc16">float</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">//float
</span><span class="sc0">                </span><span class="sc11">real8</span><span class="sc0"> </span><span class="sc11">r8</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc16">double</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">//double
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">//just 8 bytes of val, hold the values
</span><span class="sc0">        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">int1</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">//it is a string or a number or unknown, 
</span><span class="sc0">                                        </span><span class="sc2">//if it is a number, then what is the kind, int or float ?
</span><span class="sc0">                </span><span class="sc11">int1</span><span class="sc0"> </span><span class="sc11">small</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">int2</span><span class="sc0"> </span><span class="sc11">big</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">//4 bytes of attr, specify the attributives of this var
</span><span class="sc0">        </span><span class="sc2">// char&amp; c;
</span><span class="sc0">        </span><span class="sc2">// short&amp; s;
</span><span class="sc0">        </span><span class="sc2">// int&amp; i;
</span><span class="sc0">        </span><span class="sc2">// float&amp; f;
</span><span class="sc0">        </span><span class="sc2">// double&amp; d;
</span><span class="sc0">        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">cnt</span><span class="sc10">;</span><span class="sc2">//记录本类被构造次数
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in default constructor: this="</span><span class="sc10">&lt;&lt;</span><span class="sc5">this</span><span class="sc10">&lt;&lt;</span><span class="sc6">" p="</span><span class="sc10">&lt;&lt;</span><span class="sc11">p</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc11">init</span><span class="sc10">();</span><span class="sc11">p</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc10">~</span><span class="sc11">var</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in default destructor: this="</span><span class="sc10">&lt;&lt;</span><span class="sc5">this</span><span class="sc10">&lt;&lt;</span><span class="sc6">" p="</span><span class="sc10">&lt;&lt;</span><span class="sc11">p</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)}</span><span class="sc0">
        
        </span><span class="sc2">//------------------------      utils
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">init_type</span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">       </span><span class="sc2">//init before any types of constructure
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_type</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!(</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">&gt;=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">veryend</span><span class="sc0"> </span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">type</span><span class="sc10">;</span><span class="sc0">
                
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">subtype</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">number</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint4</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">cstr</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">boolean</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">object</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">number</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">type</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">type</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">object</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">subtype</span><span class="sc10">=</span><span class="sc11">type</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc0">
                        </span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"type="</span><span class="sc10">&lt;&lt;</span><span class="sc11">type</span><span class="sc10">&lt;&lt;</span><span class="sc6">" and subtype="</span><span class="sc10">&lt;&lt;</span><span class="sc11">subtype</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">veryend</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">!=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">veryend</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">init_type</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">type</span><span class="sc10">;}</span><span class="sc0">   </span><span class="sc2">//get and set type
</span><span class="sc0">        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">which</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">which</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        
        
        </span><span class="sc2">//------------------------      for char
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">sint1</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">sint1</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint1</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint1</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si1</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si1</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">uint1</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">uint1</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint1</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint1</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui1</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui1</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc16">char</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">schar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">uint1</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">uchar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">uint1</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc2">//------------------------      for short
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">sint2</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">sint2</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint2</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint2</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si2</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si2</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">uint2</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">uint2</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint2</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint2</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui2</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui2</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc16">short</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">sshort</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">short</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">uint2</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ushort</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">uint2</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc2">//------------------------      for int
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">sint4</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">sint4</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint4</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint4</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si4</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si4</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">uint4</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">uint4</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint4</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint4</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui4</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui4</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc16">int</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">sint</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">int</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">uint4</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">uint</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">uint4</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc2">//------------------------      for long long
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">sint8</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">sint8</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint8</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint8</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si8</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">si8</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">uint8</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">uint8</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint8</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint8</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui8</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ui8</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc11">int8</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">slong</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">int8</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">uint8</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ulong</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">uint8</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc2">//------------------------      for float
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">float</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">float</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">real4</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">float</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">float</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">real4</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">f</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">f</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc16">float</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">flt</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">float</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc16">float</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">tofloat</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">float</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc2">//------------------------      for double
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">double</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">double</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">real8</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">double</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">double</span><span class="sc10">);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">real8</span><span class="sc10">);</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">d</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">d</span><span class="sc10">;}</span><span class="sc0">
        
        </span><span class="sc16">double</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">dbl</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">double</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc16">double</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">todouble</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc16">double</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        
        
        
        </span><span class="sc2">//------------------------      for strings
</span><span class="sc0">        </span><span class="sc2">//deal with ref and ptr to an exist string object and ptr to a char (C-style string)
</span><span class="sc0">        </span><span class="sc2">//usage examples:
</span><span class="sc0">        </span><span class="sc2">//              string s; 
</span><span class="sc0">        </span><span class="sc2">//              var v=s;        var v(s);
</span><span class="sc0">        </span><span class="sc2">//              var w=&amp;s;       var     w(&amp;s);
</span><span class="sc0">        </span><span class="sc2">//              w=s;            w=
</span><span class="sc0">        </span><span class="sc2">//              char *p="abc";  char p[10]="abc";
</span><span class="sc0">        </span><span class="sc2">//              var s=p;        var s(p);
</span><span class="sc0">        </span><span class="sc2">//              cout&lt;&lt;s.str();
</span><span class="sc0">        </span><span class="sc2">//important notes:
</span><span class="sc0">        </span><span class="sc2">//              will not work with temp object : for example var s=string("tmp");
</span><span class="sc0">        </span><span class="sc2">//              because string("tmp") is destructed when calling var(string &amp;r)
</span><span class="sc0">        </span><span class="sc2">//              assignment of a tmp obj will not working, var c;        c=string(tmp);
</span><span class="sc0">        </span><span class="sc2">//              but string s("tmp"); var c; c=s;        works fine
</span><span class="sc0">        </span><span class="sc2">//              because c=s fist construct a tmp var obj string(s), then copy construct it to c
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">cstr</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc11">init</span><span class="sc10">(</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">cstr</span><span class="sc10">);</span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)</span><span class="sc11">r</span><span class="sc10">;}</span><span class="sc2">//maybe there is some ploblem in this way
</span><span class="sc0">        
        </span><span class="sc11">string</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">string</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">cstr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;}</span><span class="sc0">
        </span><span class="sc2">//var(const string&amp; r) {dbg(const sint8);v.s=r;p=(int*)&amp;v.s;}
</span><span class="sc0">        
        </span><span class="sc2">//------------------------      for list
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">  </span><span class="sc2">//only accept exist obj instead of tmp obj
</span><span class="sc0">                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">list</span><span class="sc10">&amp;);</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">lst</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">list</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">//------------------------      others
</span><span class="sc0">        
        </span><span class="sc16">friend</span><span class="sc0"> </span><span class="sc11">ostream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc10">&lt;&lt;(</span><span class="sc11">ostream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">//这样每次对var的运算都要来回判断if很麻烦，效率也低
</span><span class="sc0">                </span><span class="sc2">//一个想法是创建一个函数表，以type索引，针对每种类型定义一个函数，待实验
</span><span class="sc0">                </span><span class="sc2">//      funciton=func_table[type]
</span><span class="sc0">                </span><span class="sc2">//      function(out, v)
</span><span class="sc0">                
                
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">type</span><span class="sc10">;</span><span class="sc0">
                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">number</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint4</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">cstr</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">boolean</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">undef</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">object</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&gt;=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">schar</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">uchar</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">sshort</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ushort</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">sint</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">uint</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">slong</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">uint8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ulong</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">real4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">flt</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">real8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">dbl</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&gt;=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">cstr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">cstr</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">&gt;=</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">&lt;</span><span class="sc11">vt</span><span class="sc10">::</span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"[Unknown Object]"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"[I don't know the type]"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">dump</span><span class="sc10">(</span><span class="sc11">ostream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">// return out&lt;&lt;"&lt;Var this="&lt;&lt;&amp;v&lt;&lt;" p="&lt;&lt;v.p&lt;&lt;" int="&lt;&lt;v.v.si4&lt;&lt;" hex="&lt;&lt;hex&lt;&lt;v.v.si8 
</span><span class="sc0">                        </span><span class="sc2">// codemask(&lt;&lt;" : "&lt;&lt;v.str()) 
</span><span class="sc0">                        </span><span class="sc2">// &lt;&lt;"&gt;"&lt;&lt;endl;
</span><span class="sc0">                </span><span class="sc2">// return out&lt;&lt;"&lt;Var this="&lt;&lt;&amp;v
</span><span class="sc0">                                </span><span class="sc2">// &lt;&lt;" p="&lt;&lt;v.p
</span><span class="sc0">                                </span><span class="sc2">// &lt;&lt;" hex="&lt;&lt;hex&lt;&lt;v.v.ui8
</span><span class="sc0">                                </span><span class="sc2">// &lt;&lt;"&gt;"&lt;&lt;endl;
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"&lt;Var this="</span><span class="sc10">&lt;&lt;&amp;</span><span class="sc11">v</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" p="</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">p</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" char="</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">c</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" short="</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">s</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" int="</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">i</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" float="</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">f</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" double="</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">d</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">"&gt;"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// bad input funciton because don't know the type
</span><span class="sc0">        </span><span class="sc2">// imagine we need int
</span><span class="sc0">        </span><span class="sc2">// friend ostream&amp; operator&gt;&gt;(ostream&amp; in, var&amp; v) {
</span><span class="sc0">                </span><span class="sc2">// int i; in&gt;&gt;i; v.v.si4=i; dbg(input sint4); p=(int*)&amp;v.v.si4; return in;
</span><span class="sc0">        </span><span class="sc2">// }
</span><span class="sc0">         
        </span><span class="sc2">//boolean tests
</span><span class="sc0">        
        </span><span class="sc9">#define macro_var_boolean_test(is_what, type_name)      \
        bool is_what() const {  \
                return a.type==vt::type_name;   \
        }
</span><span class="sc0">        
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_char</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">schar</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_int</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">::</span><span class="sc11">sint</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_cstr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">cstr</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_string</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc10">)</span><span class="sc0">
        
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_sequence</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//is this a sequence container or not
</span><span class="sc0">                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_list</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_string</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// asserts
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">assert_sequence</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_sequence</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">assert_string</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_string</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// memory manager
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">del</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    </span><span class="sc2">//delete target on heap
</span><span class="sc0">                </span><span class="sc2">// base on the target type
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_string</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">string</span><span class="sc10">*)</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// methods
</span><span class="sc0">        </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">split</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert_sequence</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc2">// todo init python like str
</span><span class="sc0">                
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// list opertions
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">join</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert_sequence</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">template</span><span class="sc10">&lt;</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">&gt;</span><span class="sc0">
        </span><span class="sc11">T</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">tmp_obj_mgr</span><span class="sc10">(</span><span class="sc11">T</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">=</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">push_back</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">(*</span><span class="sc11">s</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        
        </span><span class="sc2">// string replace() {//return a new string, allocate in heap, managed by this ptr
</span><span class="sc0">                </span><span class="sc2">// assert_sequence();
</span><span class="sc0">                </span><span class="sc2">// string * s=new string;
</span><span class="sc0">                </span><span class="sc2">// tmp_string_link
</span><span class="sc0">                
                </span><span class="sc2">// tmp_objects_chain.push_back(s);//tmp_objects_chain will be delete finally when var object destruct
</span><span class="sc0">        </span><span class="sc2">// }
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">replace</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert_string</span><span class="sc10">();</span><span class="sc0">
                
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">size_t</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert_sequence</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_string</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">().</span><span class="sc11">size</span><span class="sc10">()</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_cstr</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cstr</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lst</span><span class="sc10">().</span><span class="sc11">size</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc5">false</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//容器操作 operations for sequence
</span><span class="sc0">        </span><span class="sc2">// is sequence
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">keys</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//return a list contains the keys of a dict
</span><span class="sc0">                </span><span class="sc11">assert_dict</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">map</span><span class="sc10">.</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">values</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//return a list contains the values of a dict
</span><span class="sc0">        
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">haskey</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">append</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">node</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//append a node to the end of a list
</span><span class="sc0">                </span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">=</span><span class="sc11">lst</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">l</span><span class="sc10">.</span><span class="sc11">push_back</span><span class="sc10">(</span><span class="sc11">node</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">extend</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">rlist</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//extend a list with another list
</span><span class="sc0">                </span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">=</span><span class="sc11">lst</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc2">//TODO
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">each</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc2">//for each
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">foreach</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">map</span><span class="sc10">(</span><span class="sc11">UnaryFunction</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">       </span><span class="sc11">id</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc2">//for list
</span><span class="sc0">        
        </span><span class="sc11">slice</span><span class="sc0">
        </span><span class="sc11">add</span><span class="sc0">
        </span><span class="sc11">dot</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc2">//最重要的是集合操作，就是list操作
</span><span class="sc10">};</span><span class="sc0">




</span><span class="sc10">}</span><span class="sc0">       </span><span class="sc2">//end of namespace pypp
</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">pypp</span><span class="sc10">::</span><span class="sc11">var</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">lst</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc9">#define Macro__over_load_dump__ValueType2( T )                           \
inline void dump( const T &amp; v, ostream &amp; out=cout ) {                   \
    out&lt;&lt;v&lt;&lt;endl;                                                       \
};                                                                      \
inline void dump( T &amp; v, ostream &amp; out=cout ) {                   \
    out&lt;&lt;v&lt;&lt;endl;                                                       \
};                                                                      \
inline void dump( T * v, ostream &amp; out=cout ) {                         \
    out&lt;&lt;v&lt;&lt;endl;                                                       \
}
</span><span class="sc0">
</span><span class="sc2">// Macro__over_load_dump__ValueType2(var);
</span><span class="sc0">
</span><span class="sc16">template</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">&gt;</span><span class="sc0">
</span><span class="sc11">T</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ref2t</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">T</span><span class="sc10">*)</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">template</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">&gt;</span><span class="sc0">
</span><span class="sc11">T</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ptr2t</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">T</span><span class="sc10">*)</span><span class="sc11">v</span><span class="sc10">-&gt;</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">)&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">// int tmp[]={1,2,3};
</span><span class="sc0">        </span><span class="sc2">// vec_int c(tmp, tmp+3);
</span><span class="sc0">        </span><span class="sc2">// print(c);
</span><span class="sc0">        
        </span><span class="sc2">// var a="jadesoul";
</span><span class="sc0">        </span><span class="sc2">// print(a);
</span><span class="sc0">        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/*

int main() {

        cout&lt;&lt;sizeof(var)&lt;&lt;endl;
        
        var s=129;
        cout&lt;&lt;s;
        const uint j=max_uint2;
        s=j;
        cout&lt;&lt;s;
        for_n(i, 4) cout&lt;&lt;hex&lt;&lt;((uint*)(&amp;s)+i)&lt;&lt;" : "&lt;&lt;hex&lt;&lt;*((uint*)(&amp;s)+i)&lt;&lt;endl;
        
        for_n(i, 16) cout&lt;&lt;(uint)*((char*)(&amp;s)+i)&lt;&lt;endl;
        
        s="jadesoul";
        cout&lt;&lt;s;
        
        vector&lt;var&gt; v(10, "jadesoul");
        v[0]=s;
        v[1]=0.1;
        v[2]=213123123123123;
        v[3]='A';
        cout&lt;&lt;ref2t&lt;int&gt;(v[3]);
        return 0;
}


Running Result:

&lt;Var this=0012FF0C p=0012FF14 int=129 hex=fffffffe00000081&gt;
&lt;Var this=0012FF0C p=0012FEFC int=1 hex=426ff700000001&gt;
&lt;Var this=0012FF0C p=004281FC int=8 hex=40d28800000008&gt;
v = [ &lt;Var this=001F1DC8 p=004281FC int=8 hex=40d28800000008&gt;
 &lt;Var this=001F1DD8 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1DE8 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1DF8 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1E08 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1E18 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1E28 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1E38 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1E48 p=00428208 int=415a34 hex=4303c000415a34&gt;
 &lt;Var this=001F1E58 p=00428208 int=415a34 hex=4303c000415a34&gt;
 ]
 
*/</span><span class="sc0">
</span><span class="sc2">//next step to do , implement the immutable object
//to enable the str var
</span><span class="sc0">
</span><span class="sc2">//to implement many methods of class var
//for example:
</span><span class="sc1">/*
var l;
l=[1,2,3]
var a=1, b=2;
print(a+b);
var s="hi, girl, i love you";
s.split(" ")
typedef vector&lt;var&gt; list;

*/</span><span class="sc0">
</span></div></body>
</html>
