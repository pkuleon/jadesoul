<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Consolas';
	font-size: 14pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	font-family: 'Consolas';
	color: #008000;
}
.sc2 {
	font-family: 'Consolas';
	color: #008000;
}
.sc3 {
	font-family: 'Consolas';
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc9">#ifndef PYPP_HPP_BY_JADESOUL
#define PYPP_HPP_BY_JADESOUL
</span><span class="sc3">/**
 * File: pypp.hpp
 * Description: a simple framework to make C++ programming as easy as python
 *
 * Copyright (c) 2011 Jadesoul (Home Page: http://jadesoul.org)
 * Licensed under the GNU General Public License:
 * http://www.gnu.org/licenses/gpl.html
 * 
 * Date: 2011-05-12 15:14:02.545000
 * Written In: Peking University, beijing, China
 */</span><span class="sc0">

</span><span class="sc9">#include &lt;jade.hpp&gt;
</span><span class="sc0">
</span><span class="sc9">#ifdef debug
</span><span class="sc0">        </span><span class="sc9">#define showt(tmp) cout&lt;&lt;typeid(tmp).name()&lt;&lt;endl
</span><span class="sc0">        </span><span class="sc9">#define showp(p) cout&lt;&lt;p&lt;&lt;endl
</span><span class="sc0">        </span><span class="sc9">#define msg(s) cout&lt;&lt;#s&lt;&lt;endl
</span><span class="sc0">        </span><span class="sc9">#define dbg(msg) cout&lt;&lt;"creating a new var: "&lt;&lt;#msg&lt;&lt;" : "&lt;&lt;r&lt;&lt;" : "&lt;&lt;this&lt;&lt;endl
</span><span class="sc0">        </span><span class="sc9">#define codemask(...) __VA_ARGS__
#else
</span><span class="sc0">        </span><span class="sc9">#define showt(tmp)
</span><span class="sc0">        </span><span class="sc9">#define showp(p)
</span><span class="sc0">        </span><span class="sc9">#define msg(s)
</span><span class="sc0">        </span><span class="sc9">#define dbg(msg)
</span><span class="sc0">        </span><span class="sc9">#define codemask(...)
#endif
</span><span class="sc0">
</span><span class="sc9">#define die cout&lt;&lt;"die @ "&lt;&lt;__FILE__&lt;&lt;" line:"&lt;&lt;__LINE__&lt;&lt;endl;assert(false);
#define bye(msg) cout&lt;&lt;"trace:\n\t"&lt;&lt;#msg&lt;&lt;endl;die;
</span><span class="sc0">
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">memmgr</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">template</span><span class="sc10">&lt;</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">&gt;</span><span class="sc2">//implemention of reference count to a heap object
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//a class to represent a dynamic allocated one object in heap (note: only one obj)
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">heapobj</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">malloc</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">~</span><span class="sc11">heapobj</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">free</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">T</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get a ptr to the obj, used when a new var wants share the ptr to the heap obj
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc2">// if (p==0) return 0;
</span><span class="sc0">                </span><span class="sc11">inc</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">release</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//release the ptr to the obj, used when a exist var do not use target any more
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">dec</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">T</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ref</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the refernce, be careful, do not delete p outside
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">T</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the pointer, be careful, do not delete p outside
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">empty</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//test if target has been deleted, 
</span><span class="sc0">                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc2">//used by memory manager to clean links
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">cnt</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">refcnt</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc1">/* void suiside() {
                delete this;
        } */</span><span class="sc0">
</span><span class="sc16">private</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">malloc</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">refcnt</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">free</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in heapobj free(): free heapobj target with p="</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">p</span><span class="sc10">&lt;&lt;</span><span class="sc6">" refcnt="</span><span class="sc10">&lt;&lt;</span><span class="sc11">refcnt</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0"> </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">refcnt</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inc</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">++</span><span class="sc11">refcnt</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">dec</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">refcnt</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">--</span><span class="sc11">refcnt</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">refcnt</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">free</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc16">private</span><span class="sc10">:</span><span class="sc2">//data
</span><span class="sc0">        </span><span class="sc11">T</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc2">//ptr to the obj in heap
</span><span class="sc0">        </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">refcnt</span><span class="sc10">;</span><span class="sc2">//the refernce count to this object, 
</span><span class="sc0">                        </span><span class="sc2">//equals to how many times calling get() without a del()
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">vector</span><span class="sc10">&lt;</span><span class="sc11">var</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&lt;</span><span class="sc11">var</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">set</span><span class="sc10">&lt;</span><span class="sc11">var</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">map</span><span class="sc10">&lt;</span><span class="sc11">var</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">memmgr</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">  </span><span class="sc2">//smart heap memory manager
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">set</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">dict</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heapstr</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heaplist</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">tuple</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heaptuple</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">set</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heapset</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">dict</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heapdict</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&lt;</span><span class="sc11">heapstr</span><span class="sc10">*&gt;</span><span class="sc0"> </span><span class="sc11">strlink</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&lt;</span><span class="sc11">heaplist</span><span class="sc10">*&gt;</span><span class="sc0"> </span><span class="sc11">listlink</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&lt;</span><span class="sc11">heaptuple</span><span class="sc10">*&gt;</span><span class="sc0"> </span><span class="sc11">tuplelink</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&lt;</span><span class="sc11">heapset</span><span class="sc10">*&gt;</span><span class="sc0"> </span><span class="sc11">setlink</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&lt;</span><span class="sc11">heapdict</span><span class="sc10">*&gt;</span><span class="sc0"> </span><span class="sc11">dictlink</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">private</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">strlink</span><span class="sc0"> </span><span class="sc11">strlnk</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">listlink</span><span class="sc0"> </span><span class="sc11">listlnk</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">tuplelink</span><span class="sc0"> </span><span class="sc11">tpllnk</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setlink</span><span class="sc0"> </span><span class="sc11">setlnk</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">dictlink</span><span class="sc0"> </span><span class="sc11">dictlnk</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">memmgr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">show_state</span><span class="sc10">(</span><span class="sc6">"when init"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">~</span><span class="sc11">memmgr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">show_state</span><span class="sc10">(</span><span class="sc6">"before delete"</span><span class="sc10">);</span><span class="sc0">
                
                </span><span class="sc9">#define macro_delete_link(lnk) while(NOT lnk.empty()) { \
                        codemask(cout&lt;&lt;"delete a heapobj in "&lt;&lt;#lnk&lt;&lt;endl;)     \
                        delete lnk.front(); lnk.pop_front(); }
</span><span class="sc0">                </span><span class="sc11">macro_delete_link</span><span class="sc10">(</span><span class="sc11">strlnk</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">macro_delete_link</span><span class="sc10">(</span><span class="sc11">listlnk</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">macro_delete_link</span><span class="sc10">(</span><span class="sc11">tpllnk</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">macro_delete_link</span><span class="sc10">(</span><span class="sc11">setlnk</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">macro_delete_link</span><span class="sc10">(</span><span class="sc11">dictlnk</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc9">#undef macro_delete_link
</span><span class="sc0">                
                </span><span class="sc11">show_state</span><span class="sc10">(</span><span class="sc6">"after delete"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">template</span><span class="sc10">&lt;</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">T</span><span class="sc10">&gt;</span><span class="sc0">
        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">is_target_deleted</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//unary predicate to tell if the target of a heapobj is deleted
</span><span class="sc0">                </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc10">()(</span><span class="sc11">T</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc6">"find one empty heapobj"</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">-&gt;</span><span class="sc11">empty</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">};</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">auto_clean</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//the garbage collection
</span><span class="sc0">                </span><span class="sc2">//automatically clean the heapobj whose target has already been deleted
</span><span class="sc0">                </span><span class="sc9">#define clean_empty_heapobj_in_link(strlnk, heapstr) strlnk.remove_if(is_target_deleted&lt;heapstr&gt;());
</span><span class="sc0">                </span><span class="sc11">clean_empty_heapobj_in_link</span><span class="sc10">(</span><span class="sc11">strlnk</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heapstr</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">clean_empty_heapobj_in_link</span><span class="sc10">(</span><span class="sc11">listlnk</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heaplist</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">clean_empty_heapobj_in_link</span><span class="sc10">(</span><span class="sc11">tpllnk</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heaptuple</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">clean_empty_heapobj_in_link</span><span class="sc10">(</span><span class="sc11">setlnk</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heapset</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">clean_empty_heapobj_in_link</span><span class="sc10">(</span><span class="sc11">dictlnk</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heapdict</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc9">#undef clean_empty_heapobj_in_link
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">show_state</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"[ mmgr: "</span><span class="sc10">&lt;&lt;</span><span class="sc11">msg</span><span class="sc10">&lt;&lt;</span><span class="sc6">" ] "</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" str: "</span><span class="sc10">&lt;&lt;</span><span class="sc11">strlnk</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc10">()</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" list: "</span><span class="sc10">&lt;&lt;</span><span class="sc11">listlnk</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc10">()</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" tuple: "</span><span class="sc10">&lt;&lt;</span><span class="sc11">tpllnk</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc10">()</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" set: "</span><span class="sc10">&lt;&lt;</span><span class="sc11">setlnk</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc10">()</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">" dict: "</span><span class="sc10">&lt;&lt;</span><span class="sc11">dictlnk</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc10">()</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc9">#define macro_new_operator(type, func, lnk) type&amp; func() { type* p=new type; lnk.push_front(p); return *p; }
</span><span class="sc0">        </span><span class="sc11">macro_new_operator</span><span class="sc10">(</span><span class="sc11">heapstr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newstr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlnk</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_new_operator</span><span class="sc10">(</span><span class="sc11">heaplist</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newlist</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">listlnk</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_new_operator</span><span class="sc10">(</span><span class="sc11">heaptuple</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newtuple</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tpllnk</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_new_operator</span><span class="sc10">(</span><span class="sc11">heapset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">setlnk</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_new_operator</span><span class="sc10">(</span><span class="sc11">heapdict</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newdict</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dictlnk</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc9">#undef macro_new_operator
</span><span class="sc0">        
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">mmgr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">//design this tmp object memmory manager, when program finish, it will clean all
</span><span class="sc0">

</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">set</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">dict</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">str</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heapstr</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">list</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heaplist</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">tuple</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heaptuple</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">set</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heapset</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">heapobj</span><span class="sc10">&lt;</span><span class="sc11">py</span><span class="sc10">::</span><span class="sc11">dict</span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">heapdict</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">private</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//data of all kinds of var, only one kind at a time
</span><span class="sc0">                </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for non-const ref=obj&amp; or ptr=&amp;obj in stack, save its pointer
</span><span class="sc0">                        </span><span class="sc11">str</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">list</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">tuple</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">set</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">dict</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">stack</span><span class="sc10">;</span><span class="sc2">//4 bytes
</span><span class="sc0">                
                </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for non-const obj ref or ptr, often created in var member functions, 
</span><span class="sc0">                                </span><span class="sc2">//save its heapobj pointer, and real obj pointer
</span><span class="sc0">                        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for str
</span><span class="sc0">                                </span><span class="sc11">heapstr</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc2">//points to the heapobj who points to the real obj on heap
</span><span class="sc0">                                </span><span class="sc11">str</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc2">//the same as pheap-&gt;ptr(), but this will be faster 
</span><span class="sc0">                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">heaplist</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc11">list</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">heaptuple</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc11">tuple</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">heapset</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc11">set</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">heapdict</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc11">dict</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc10">;</span><span class="sc2">//8 bytes
</span><span class="sc0">                
                </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for const built-in type, save its data, 8 bytes
</span><span class="sc0">                        </span><span class="sc11">sint1</span><span class="sc0"> </span><span class="sc11">si1</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">//char
</span><span class="sc0">                        </span><span class="sc11">uint1</span><span class="sc0"> </span><span class="sc11">ui1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">uchar</span><span class="sc0"> </span><span class="sc11">uc</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">sint2</span><span class="sc0"> </span><span class="sc11">si2</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">//short
</span><span class="sc0">                        </span><span class="sc11">uint2</span><span class="sc0"> </span><span class="sc11">ui2</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">ushort</span><span class="sc0"> </span><span class="sc11">us</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">sint4</span><span class="sc0"> </span><span class="sc11">si4</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc2">//int
</span><span class="sc0">                        </span><span class="sc11">uint4</span><span class="sc0"> </span><span class="sc11">ui4</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">ui</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">sint8</span><span class="sc0"> </span><span class="sc11">si8</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc11">slong</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">//long long
</span><span class="sc0">                        </span><span class="sc11">uint8</span><span class="sc0"> </span><span class="sc11">ui8</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc11">ulong</span><span class="sc0"> </span><span class="sc11">ul</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">real4</span><span class="sc0"> </span><span class="sc11">r4</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc16">float</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">//float
</span><span class="sc0">                        </span><span class="sc11">real8</span><span class="sc0"> </span><span class="sc11">r8</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc16">double</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">//double
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">builtin</span><span class="sc10">;</span><span class="sc2">//8 bytes
</span><span class="sc0">                
                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//fot fast assignment
</span><span class="sc0">                        </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">low4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">high4</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">dwords</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//fot fast assignment
</span><span class="sc0">                        </span><span class="sc11">ulong</span><span class="sc0"> </span><span class="sc11">all</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">dwords64</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//fot fast assignment
</span><span class="sc0">                        </span><span class="sc11">slong</span><span class="sc0"> </span><span class="sc11">all</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">dwords64signed</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">;</span><span class="sc2">//8 bytes
</span><span class="sc0">        </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//first byte, main obj type
</span><span class="sc0">                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">stack</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc2">//is it a obj in stack
</span><span class="sc0">                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc2">//is it a obj in heap
</span><span class="sc0">                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">builtin</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc2">//is it a built-in type
</span><span class="sc0">                        </span><span class="sc11">uchar</span><span class="sc0"> </span><span class="sc11">undef1</span><span class="sc10">:</span><span class="sc4">5</span><span class="sc10">;</span><span class="sc2">//tmp no use
</span><span class="sc0">                        
                        </span><span class="sc2">//second byte, kinds of obj, no matter in stack or heap
</span><span class="sc0">                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">uchar</span><span class="sc0"> </span><span class="sc11">undef2</span><span class="sc10">:</span><span class="sc4">3</span><span class="sc10">;</span><span class="sc2">//tmp no use
</span><span class="sc0">                        
                        </span><span class="sc2">//third byte, kinds of integer built-in types
</span><span class="sc0">                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        
                        </span><span class="sc2">//last byte, kinds of float built-in types
</span><span class="sc0">                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">real4</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">real8</span><span class="sc10">:</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">uchar</span><span class="sc0"> </span><span class="sc11">undef4</span><span class="sc10">:</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc2">//tmp no use
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc2">//hold attributives, 32 attrs in 4 bytes
</span><span class="sc0">                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">types</span><span class="sc10">:</span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">objs</span><span class="sc10">:</span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ints</span><span class="sc10">:</span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">floats</span><span class="sc10">:</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">bytes</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">low</span><span class="sc10">:</span><span class="sc4">16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">high</span><span class="sc10">:</span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">words</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">all</span><span class="sc10">:</span><span class="sc4">32</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">dwords</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">;</span><span class="sc2">//4 bytes
</span><span class="sc0">
</span><span class="sc16">private</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc2">//----------------------------------------- utils
</span><span class="sc0">        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_as_undefined</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">reset_attr</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">reset_data</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">reset_attr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">dwords</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">reset_data</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">// data.dwords.low4=data.dwords.high4=0;
</span><span class="sc0">                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">dwords64</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//set main types
</span><span class="sc0">        </span><span class="sc9">#define macro_set_type(func, type)\
        inline void func() {                            \
                attr.bytes.types=0;                     \
                attr.bits.type=1;                       \
        }
</span><span class="sc0">        </span><span class="sc11">macro_set_type</span><span class="sc10">(</span><span class="sc11">set_type_stack</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">stack</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_type</span><span class="sc10">(</span><span class="sc11">set_type_heap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_type</span><span class="sc10">(</span><span class="sc11">set_type_builtin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">builtin</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc9">#undef macro_set_type
</span><span class="sc0">        
        </span><span class="sc2">//set obj types
</span><span class="sc0">        </span><span class="sc9">#define macro_set_obj(func, obj)        \
        inline void func() {                            \
                attr.bytes.objs=0;                      \
                attr.bits.obj=1;                        \
        }
</span><span class="sc0">        </span><span class="sc11">macro_set_obj</span><span class="sc10">(</span><span class="sc11">set_obj_str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_obj</span><span class="sc10">(</span><span class="sc11">set_obj_list</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_obj</span><span class="sc10">(</span><span class="sc11">set_obj_tuple</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_obj</span><span class="sc10">(</span><span class="sc11">set_obj_set</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_obj</span><span class="sc10">(</span><span class="sc11">set_obj_dict</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc9">#undef macro_set_obj
</span><span class="sc0">        
        </span><span class="sc2">//set built-in types
</span><span class="sc0">        </span><span class="sc9">#define macro_set_builtin(func, builtin)\
        inline void func() {                                    \
                attr.words.high=0;                              \
                attr.bits.builtin=1;                            \
        }
</span><span class="sc0">        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_sint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_uint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_sint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_uint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_sint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_uint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_sint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_uint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_real4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">real4</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_set_builtin</span><span class="sc10">(</span><span class="sc11">set_builtin_real8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">real8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc9">#undef macro_set_builtin
</span><span class="sc0">
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_as_str</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//init myself as a new str var
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_undefined</span><span class="sc10">());</span><span class="sc2">//this function should only be called by constructors, 
</span><span class="sc0">                                                        </span><span class="sc2">//each constructor should call init_as_undefined() first
</span><span class="sc0">                </span><span class="sc11">set_type_heap</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_str</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">heapstr</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">str</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">h</span><span class="sc10">=&amp;</span><span class="sc11">mmgr</span><span class="sc10">.</span><span class="sc11">newstr</span><span class="sc10">();</span><span class="sc2">//new a heapstr, automatically record it in link list
</span><span class="sc0">                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in init_as_str increase the heapstr "</span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">&lt;&lt;</span><span class="sc6">" refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc2">//cache the target ptr, inc the refcnt to 1
</span><span class="sc0">                </span><span class="sc11">p</span><span class="sc10">-&gt;</span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc2">//assign r to the string
</span><span class="sc0">        </span><span class="sc10">};</span><span class="sc0">
        
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">construct_from_const_cstr</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for a c-style string, convert it to a heapstring
</span><span class="sc0">                </span><span class="sc11">init_as_str</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_as_list</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//init myself as a new list var
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_undefined</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc11">set_type_heap</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_list</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">heaplist</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">list</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">h</span><span class="sc10">=&amp;</span><span class="sc11">mmgr</span><span class="sc10">.</span><span class="sc11">newlist</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in init_as_list increase the heaplist "</span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">&lt;&lt;</span><span class="sc6">" refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc2">//cache the target ptr, inc the refcnt to 1
</span><span class="sc0">                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">&lt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//init from iterators
</span><span class="sc0">                        </span><span class="sc11">p</span><span class="sc10">-&gt;</span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc2">//assign
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">};</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//init myself as a new tuple var
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_undefined</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc11">set_type_heap</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_tuple</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">heaptuple</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">tuple</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">h</span><span class="sc10">=&amp;</span><span class="sc11">mmgr</span><span class="sc10">.</span><span class="sc11">newtuple</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in init_as_tuple increase the heaptuple "</span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">&lt;&lt;</span><span class="sc6">" refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc2">//cache the target ptr, inc the refcnt to 1
</span><span class="sc0">                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">&lt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">p</span><span class="sc10">-&gt;</span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc2">//assign
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">};</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_as_set</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//init myself as a new set var
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_undefined</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc11">set_type_heap</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_set</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">heapset</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">set</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">h</span><span class="sc10">=&amp;</span><span class="sc11">mmgr</span><span class="sc10">.</span><span class="sc11">newset</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in init_as_set increase the heapset "</span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">&lt;&lt;</span><span class="sc6">" refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc2">//cache the target ptr, inc the refcnt to 1
</span><span class="sc0">                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">&lt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">p</span><span class="sc10">-&gt;</span><span class="sc11">insert</span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc2">//assign
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">};</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_as_dict</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//init myself as a new dict var
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_undefined</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc11">set_type_heap</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_dict</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">heapdict</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">dict</span><span class="sc10">*&amp;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">h</span><span class="sc10">=&amp;</span><span class="sc11">mmgr</span><span class="sc10">.</span><span class="sc11">newdict</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in init_as_dict increase the heapdict "</span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">&lt;&lt;</span><span class="sc6">" refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc2">//cache the target ptr, inc the refcnt to 1
</span><span class="sc0">                
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">end</span><span class="sc10">&gt;=</span><span class="sc11">begin</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">end</span><span class="sc10">-</span><span class="sc11">begin</span><span class="sc10">)%</span><span class="sc4">2</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc2">//even key-value pairs
</span><span class="sc0">                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0">  </span><span class="sc11">it</span><span class="sc10">=</span><span class="sc11">begin</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">it</span><span class="sc10">&lt;</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">++</span><span class="sc11">it</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">++</span><span class="sc11">it</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc10">)[*</span><span class="sc11">it</span><span class="sc10">]=*(</span><span class="sc11">it</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc2">//assign
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">};</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//often used by copy constructions
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">==&amp;</span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">why</span><span class="sc0"> </span><span class="sc11">you</span><span class="sc0"> </span><span class="sc11">give</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc11">the</span><span class="sc0"> </span><span class="sc11">same</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">?);</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">before</span><span class="sc0"> </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">);</span><span class="sc11">dump</span><span class="sc10">();)</span><span class="sc0">
                
                </span><span class="sc2">//first check my heap
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc11">is</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc0"> </span><span class="sc11">but</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">object</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc2">//then copy data from you
</span><span class="sc0">                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">dwords64</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">dwords64</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">dwords</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">=</span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">dwords</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc2">// memcpy(this, &amp;r, sizeof(var));
</span><span class="sc0">                
                </span><span class="sc2">//finally check your heap
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in smart_clone_from_another_var increase the heapstr refcnt: "</span><span class="sc0">
                                </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in smart_clone_from_another_var increase the heaplist refcnt to: "</span><span class="sc0">
                                </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in smart_clone_from_another_var increase the heaptuple refcnt to: "</span><span class="sc0">
                                </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in smart_clone_from_another_var increase the heapset refcnt to: "</span><span class="sc0">
                                </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in smart_clone_from_another_var increase the heapdict refcnt to: "</span><span class="sc0">
                                </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()+</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"+1"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">after</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc11">is</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc0"> </span><span class="sc11">but</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">object</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">after</span><span class="sc0"> </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">);</span><span class="sc11">dump</span><span class="sc10">();)</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc2">//funcs
</span><span class="sc0">        </span><span class="sc2">//memory utils
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">mmclean</span><span class="sc10">(){</span><span class="sc2">//clean tmp mamory links, remove those whose target is empty
</span><span class="sc0">                </span><span class="sc11">mmgr</span><span class="sc10">.</span><span class="sc11">auto_clean</span><span class="sc10">();</span><span class="sc2">//call this func for a period of run time will save heap memory
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//boolean tests : test bits
</span><span class="sc0">        </span><span class="sc9">#define macro_var_boolean_test(func, bit) inline bool func() const { return attr.bits.bit; }
</span><span class="sc0">        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">stack</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_builtin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">builtin</span><span class="sc10">)</span><span class="sc0">
        
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">)</span><span class="sc0">
        
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_sint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_schar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_uint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_uchar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_sint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_sshort</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_uint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_ushort</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_sint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_sint</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint4</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_uint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_uint</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint4</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_sint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_slong</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_uint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_ulong</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_real4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">real4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_float</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">real4</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_real8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">real8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">macro_var_boolean_test</span><span class="sc10">(</span><span class="sc11">is_double</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">real8</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc9">#undef macro_var_boolean_test
</span><span class="sc0">        
        </span><span class="sc2">//more boolen tests
</span><span class="sc0">        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_undefined</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">dwords</span><span class="sc10">.</span><span class="sc11">all</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_char</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_schar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_uchar</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_short</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_sshort</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_ushort</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_int</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_sint</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_uint</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_long</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_slong</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_ulong</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_sequence</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_str</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_list</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_container</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_str</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_list</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_set</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_dict</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_immutable</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_str</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_tuple</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_obj</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> 
                </span><span class="sc2">// return is_str() OR is_list() OR is_tuple() OR is_set() OR is_dict();
</span><span class="sc0">                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">objs</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc2">//this is much more faster
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_num</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">NOT</span><span class="sc0"> </span><span class="sc11">is_obj</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_snum</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_schar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_sshort</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_sint</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_slong</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_unum</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">is_uchar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_ushort</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_uint</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc11">OR</span><span class="sc0"> </span><span class="sc11">is_ulong</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_integer</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">ints</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">floats</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">inline</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_decimal</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">ints</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc11">AND</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">floats</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//default construction
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc2">//must call this in each construct funcs
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//construct from another var
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">form</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">form</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">(</span><span class="sc5">const_cast</span><span class="sc10">&lt;</span><span class="sc11">var</span><span class="sc10">&amp;&gt;(</span><span class="sc11">r</span><span class="sc10">));</span><span class="sc2">//TODO: maybe there is some problem in this way
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//default destruction
</span><span class="sc0">        </span><span class="sc10">~</span><span class="sc11">var</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">//check heap
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in ~var release a heapstr refernce, refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"-1="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()-</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in ~var release a heaplist refernce, refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"-1="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()-</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in ~var release a heaptuple refernce, refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"-1="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()-</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in ~var release a heapset refernce, refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"-1="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()-</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">codemask</span><span class="sc10">(</span><span class="sc11">cout</span><span class="sc10">&lt;&lt;</span><span class="sc6">"in ~var release a heapdict refernce, refcnt: "</span><span class="sc0">
                                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()&lt;&lt;</span><span class="sc6">"-1="</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">cnt</span><span class="sc10">()-</span><span class="sc4">1</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;)</span><span class="sc0">
                                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pheap</span><span class="sc10">-&gt;</span><span class="sc11">release</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">impossible</span><span class="sc0"> </span><span class="sc11">run</span><span class="sc0"> </span><span class="sc11">here</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//constructions from built-in type
</span><span class="sc0">        </span><span class="sc9">#define macro_construct_from_builtin_type(sint1, set_builtin_sint1, si1, schar)\
        var(sint1&amp; r) {\
                dbg(sint1);\
                init_as_undefined();\
                set_type_builtin();\
                set_builtin_sint1();\
                data.builtin.si1=r;\
        }\
        var(const sint1&amp; r) {\
                dbg(const sint1);\
                init_as_undefined();\
                set_type_builtin();\
                set_builtin_sint1();\
                data.builtin.si1=r;\
        }\
        inline sint1&amp; schar() {\
                return data.builtin.si1;\
        }\
        inline const sint1&amp; schar() const {\
                return data.builtin.si1;\
        }
</span><span class="sc0">        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">sint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_sint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">si1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">schar</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">uint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_uint1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ui1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uchar</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">sint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_sint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">si2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sshort</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">uint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_uint2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ui2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ushort</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">sint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_sint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">si4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sint</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">uint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_uint4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ui4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">sint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_sint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">si8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">slong</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">uint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_uint8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ui8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ulong</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">real4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_real4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">r4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">flt</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">macro_construct_from_builtin_type</span><span class="sc10">(</span><span class="sc11">real8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">set_builtin_real8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">r8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dbl</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc9">#undef macro_construct_from_builtin_type
</span><span class="sc0">        
        </span><span class="sc2">//now comes constructions for strings from a stack object
</span><span class="sc0">        </span><span class="sc2">//------------------------      for strings
</span><span class="sc0">        </span><span class="sc2">//deal with ref and ptr to an exist string object and ptr to a char (C-style string)
</span><span class="sc0">        </span><span class="sc2">//usage examples:
</span><span class="sc0">        </span><span class="sc2">//              string s; 
</span><span class="sc0">        </span><span class="sc2">//              var v=s;        var v(s);
</span><span class="sc0">        </span><span class="sc2">//              var w=&amp;s;       var     w(&amp;s);
</span><span class="sc0">        </span><span class="sc2">//              w=s;            w=
</span><span class="sc0">        </span><span class="sc2">//              char *p="abc";  char p[10]="abc";
</span><span class="sc0">        </span><span class="sc2">//              var s=p;        var s(p);
</span><span class="sc0">        </span><span class="sc2">//              cout&lt;&lt;s.str();
</span><span class="sc0">        </span><span class="sc2">//important notes:
</span><span class="sc0">        </span><span class="sc2">//              will not work with temp object : for example var s=string("tmp");
</span><span class="sc0">        </span><span class="sc2">//              because string("tmp") is destructed when calling var(string &amp;r)
</span><span class="sc0">        </span><span class="sc2">//              assignment of a tmp obj will not working, var c;        c=string(tmp);
</span><span class="sc0">        </span><span class="sc2">//              but string s("tmp"); var c; c=s;        works fine
</span><span class="sc0">        </span><span class="sc2">//              because c=s fist construct a tmp var obj string(s), then copy construct it to c
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//assume that string is in stack, do never use var(*(new string()))
</span><span class="sc0">                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;);</span><span class="sc2">//or var s=string()
</span><span class="sc0">                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_type_stack</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_str</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">=&amp;</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for strings , save in a heap object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for const, copy construct it in heap
</span><span class="sc0">                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">construct_from_const_cstr</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">c_str</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//special, from a c-style string
</span><span class="sc0">                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">construct_from_const_cstr</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//special, from a const c-style string
</span><span class="sc0">                </span><span class="sc11">dbg</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">construct_from_const_cstr</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for str, iterators
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_str</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">c_str</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for list from a stack object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_type_stack</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_list</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">=&amp;</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for list, save in a heap object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for list, iterators
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">init_as_list</span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        
        </span><span class="sc2">//now comes constructions for tuple from a stack object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">tuple</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_type_stack</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_tuple</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">=&amp;</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for tuple, save in a heap object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 2 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 3 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 4 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 5 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 6 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">6</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 7 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for tuple, 8 vars
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">init</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">with</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0"> </span><span class="sc11">vars</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[]={</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">};</span><span class="sc0">
                </span><span class="sc11">init_as_tuple</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">+</span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for set from a stack object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">set</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_type_stack</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_set</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">=&amp;</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for set, save in a heap object
</span><span class="sc0">        
        </span><span class="sc2">//now comes constructions for dict from a stack object
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">dict</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">init_as_undefined</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_type_stack</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">set_obj_dict</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">=&amp;</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now comes constructions for dict, save in a heap object
</span><span class="sc0">        
        
        </span><span class="sc2">//getters for str
</span><span class="sc0">        </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">tostr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get a copy
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc2">//TODO: convert non-string to string
</span><span class="sc0">                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"&lt;in tostr: not a string&gt;"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">string</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">refstr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the ref
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">refstr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">ref</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">;</span><span class="sc2">//for compile successfully
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">cstr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//design this func just for fast speed, only for str on heap or stack
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">).</span><span class="sc11">c_str</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">).</span><span class="sc11">c_str</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"&lt;in cstr: this var seems not a string&gt;"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//getters for list
</span><span class="sc0">        </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">tolist</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get a copy
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">tolist</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">();</span><span class="sc2">//for compile successfully
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">list</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">reflist</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the ref
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">list</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">reflist</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">ref</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">plist</span><span class="sc10">;</span><span class="sc2">//for compile successfully
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//getters for tuple
</span><span class="sc0">        </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc11">totuple</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get a copy
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">totuple</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">tuple</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">reftuple</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the ref
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">tuple</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">reftuple</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">ref</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">ptuple</span><span class="sc10">;</span><span class="sc2">//for compile successfully
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//getters for set
</span><span class="sc0">        </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc11">toset</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get a copy
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">toset</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">set</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">refset</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the ref
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">set</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">refset</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">ref</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pset</span><span class="sc10">;</span><span class="sc2">//for compile successfully
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//getters for dict
</span><span class="sc0">        </span><span class="sc11">dict</span><span class="sc0"> </span><span class="sc11">todict</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get a copy
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">todict</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">dict</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">refdict</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//get the ref
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">dict</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">refdict</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">cannot</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">ref</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pdict</span><span class="sc10">;</span><span class="sc2">//for compile successfully
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//now is the funcs that let var change its original type to a new one
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">aslist</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//change itself to a list
</span><span class="sc0">                </span><span class="sc2">//if it is a list before, nothing to do
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//TODO
</span><span class="sc0">                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">asstr</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//change itself to a str
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//TODO
</span><span class="sc0">                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">astuple</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//change itself to a str
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//TODO
</span><span class="sc0">                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">asset</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//change itself to a str
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//TODO
</span><span class="sc0">                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">asdict</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//change itself to a str
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//TODO
</span><span class="sc0">                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        
        
        
        </span><span class="sc2">//now comes the copy constructions
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc0"> </span><span class="sc10">=(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//for copy construction
</span><span class="sc0">                </span><span class="sc2">//if r points to a heap obj, share it
</span><span class="sc0">                </span><span class="sc2">//no need  to init here
</span><span class="sc0">                </span><span class="sc11">msg</span><span class="sc10">(</span><span class="sc11">entering</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc11">construct</span><span class="sc0"> </span><span class="sc11">form</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">smart_clone_from_another_var</span><span class="sc10">(</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc9">#define macro_copy_construct_from_other_type(type)\
        var&amp; operator =(type r) {\
                msg(assignment form type r: about to create tmp var);\
                var tmp(r);\
                return smart_clone_from_another_var(tmp);\
        }\
        var&amp; operator =(const type r) {\
                msg(assignment form type r: about to create tmp var);\
                var tmp(r);\
                return smart_clone_from_another_var(tmp);\
        }
</span><span class="sc0">        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc0">     </span><span class="sc2">//for c-string
</span><span class="sc0">        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc10">&amp;)</span><span class="sc0">   </span><span class="sc2">//for string
</span><span class="sc0">        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">sint1</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">uint1</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">sint2</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">uint2</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">sint4</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">uint4</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">sint8</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">uint8</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">real4</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc11">macro_copy_construct_from_other_type</span><span class="sc10">(</span><span class="sc11">real8</span><span class="sc10">&amp;)</span><span class="sc0">
        </span><span class="sc2">//TODO: for list, tuple , dict
</span><span class="sc0">        </span><span class="sc9">#undef macro_copy_construct_from_other_type
</span><span class="sc0">        
        
        </span><span class="sc2">//operators &lt; &gt; == &lt;= &gt;= !=
</span><span class="sc0">        </span><span class="sc9">#define macro_operator_compare(op)\
        bool operator  op (const var&amp; r) const {\
                const var&amp; a=*this, &amp;b=r;\
                if (a.is_builtin() AND b.is_builtin()) {\
                        if (a.is_snum() AND b.is_snum()) return a.data.dwords64signed.all op b.data.dwords64signed.all;\
                        else if (a.is_unum() AND b.is_unum()) return a.data.dwords64.all op b.data.dwords64.all;\
                        else if (a.is_snum() AND b.is_unum()) return a.data.dwords64signed.all op b.data.dwords64.all;\
                        else if (a.is_unum() AND b.is_snum()) return a.data.dwords64.all op b.data.dwords64signed.all;\
                        else if (a.is_float() AND b.is_float()) return a.data.builtin.f op b.data.builtin.f;\
                        else if (a.is_double() AND b.is_double()) return a.data.builtin.d op b.data.builtin.d;\
                        else if (a.is_float() AND b.is_double()) return a.data.builtin.f op b.data.builtin.d;\
                        else if (a.is_double() AND b.is_float()) return a.data.builtin.d op b.data.builtin.f;\
                        else return &amp;a  op  &amp;b;\
                } else if (a.is_str() AND b.is_str()) {\
                        if (a.is_heap() AND b.is_heap()) return (*a.data.heap.str.pstr)  op  (*b.data.heap.str.pstr);\
                        else if (a.is_stack() AND b.is_stack()) return (*a.data.stack.pstr)  op  (*b.data.stack.pstr);\
                        else if (a.is_heap() AND b.is_stack()) return (*a.data.heap.str.pstr)  op  (*b.data.stack.pstr);\
                        else if (a.is_stack() AND b.is_heap()) return (*a.data.stack.pstr)  op  (*b.data.heap.str.pstr);\
                        else bye(in operator op: impossible here);\
                } else return &amp;a  op  &amp;b;\
        }
</span><span class="sc0">        </span><span class="sc11">macro_operator_compare</span><span class="sc10">(&lt;)</span><span class="sc0">
        </span><span class="sc11">macro_operator_compare</span><span class="sc10">(&gt;)</span><span class="sc0">
        </span><span class="sc11">macro_operator_compare</span><span class="sc10">(==)</span><span class="sc0">
        </span><span class="sc11">macro_operator_compare</span><span class="sc10">(!=)</span><span class="sc0">
        </span><span class="sc11">macro_operator_compare</span><span class="sc10">(&lt;=)</span><span class="sc0">
        </span><span class="sc11">macro_operator_compare</span><span class="sc10">(&gt;=)</span><span class="sc0">
        </span><span class="sc9">#undef macro_operator_compare
</span><span class="sc0">        
        </span><span class="sc2">//input and output operators
</span><span class="sc0">        </span><span class="sc16">friend</span><span class="sc0"> </span><span class="sc11">istream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc10">&gt;&gt;(</span><span class="sc11">istream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_undefined</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc2">//don't know what to input
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_heap</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;(*</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">heap</span><span class="sc10">.</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_stack</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;(*</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">stack</span><span class="sc10">.</span><span class="sc11">pstr</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc10">&gt;&gt;:</span><span class="sc0"> </span><span class="sc11">is</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc11">but</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">heap</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc11">stack</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_num</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_schar</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">schar</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_uchar</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">uchar</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_sshort</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">sshort</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_ushort</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ushort</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_sint</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">sint</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_uint</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">uint</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_slong</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">slong</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_ulong</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ulong</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_float</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">flt</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_double</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">&gt;&gt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">dbl</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc2">//"TODO";
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc2">//"TODO";
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc2">//"TODO";
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc2">//"TODO";
</span><span class="sc0">                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc10">&gt;&gt;:</span><span class="sc0"> </span><span class="sc11">impossible</span><span class="sc0"> </span><span class="sc11">run</span><span class="sc0"> </span><span class="sc11">here</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">friend</span><span class="sc0"> </span><span class="sc11">ostream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc10">&lt;&lt;(</span><span class="sc11">ostream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_undefined</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"undefined"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">cstr</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_num</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_schar</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">schar</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_uchar</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">uchar</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_sshort</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">sshort</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_ushort</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ushort</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_sint</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">sint</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_uint</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">uint</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_slong</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">slong</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_ulong</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">ulong</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_float</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">flt</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_double</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">dbl</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"TODO"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_tuple</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"TODO"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_set</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"TODO"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">is_dict</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"TODO"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"[Unknown Type]"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//debug utils
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">dump</span><span class="sc10">(</span><span class="sc11">ostream</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">=</span><span class="sc11">cout</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">out</span><span class="sc10">&lt;&lt;</span><span class="sc6">"&lt;Var this="</span><span class="sc10">&lt;&lt;</span><span class="sc5">this</span><span class="sc10">&lt;&lt;</span><span class="sc6">" data: "</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">dwords</span><span class="sc10">.</span><span class="sc11">low4</span><span class="sc10">&lt;&lt;</span><span class="sc6">" "</span><span class="sc10">&lt;&lt;</span><span class="sc11">hex</span><span class="sc10">&lt;&lt;</span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">dwords</span><span class="sc10">.</span><span class="sc11">high4</span><span class="sc10">&lt;&lt;</span><span class="sc6">" attr: "</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">bitset</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">&gt;(</span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">types</span><span class="sc10">)&lt;&lt;</span><span class="sc6">" "</span><span class="sc10">&lt;&lt;</span><span class="sc11">bitset</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">&gt;(</span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">objs</span><span class="sc10">)&lt;&lt;</span><span class="sc6">" "</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc11">bitset</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">&gt;(</span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">ints</span><span class="sc10">)&lt;&lt;</span><span class="sc6">" "</span><span class="sc10">&lt;&lt;</span><span class="sc11">bitset</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">&gt;(</span><span class="sc11">attr</span><span class="sc10">.</span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">floats</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">&lt;&lt;</span><span class="sc6">"&gt;"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
                        
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//in member funcions of var, there is no need new var manually, because if forget
</span><span class="sc0">        </span><span class="sc2">//to delete it, the obj in heap if it points to , will remain not been deleted
</span><span class="sc0">        </span><span class="sc2">//creating a var obj in stack is better, have fun using copy constructors :)
</span><span class="sc0">        </span><span class="sc2">//just treat var as an built-in type like int
</span><span class="sc0">        
        
        </span><span class="sc2">//------------------------      for list
</span><span class="sc0">        </span><span class="sc2">// var(list&amp; r) {       //only accept exist obj instead of tmp obj
</span><span class="sc0">                </span><span class="sc2">// dbg(list&amp;);
</span><span class="sc0">                </span><span class="sc2">// p=(int*)&amp;r;
</span><span class="sc0">        </span><span class="sc2">// }
</span><span class="sc0">        
        </span><span class="sc2">// list&amp; lst() const { return *(list*)p; }
</span><span class="sc0">        </span><span class="sc2">//------------------------      others
</span><span class="sc0">        
        
        </span><span class="sc2">// methods for sequences
</span><span class="sc0">        </span><span class="sc11">list</span><span class="sc0"> </span><span class="sc11">split</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_sequence</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc2">// todo init python like str
</span><span class="sc0">                
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// list opertions
</span><span class="sc0">        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">join</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_sequence</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">// string replace() {//return a new string, allocate in heap, managed by this ptr
</span><span class="sc0">                </span><span class="sc2">// assert(is_sequence());
</span><span class="sc0">                </span><span class="sc2">// string * s=new string;
</span><span class="sc0">                </span><span class="sc2">// tmp_string_link
</span><span class="sc0">                
                </span><span class="sc2">// tmp_objects_chain.push_back(s);//tmp_objects_chain will be delete finally when var object destruct
</span><span class="sc0">        </span><span class="sc2">// }
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">replace</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">());</span><span class="sc0">
                
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">size_t</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_sequence</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_str</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">refstr</span><span class="sc10">().</span><span class="sc11">size</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">is_list</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">reflist</span><span class="sc10">().</span><span class="sc11">size</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">bye</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc11">sequence</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//operations for sequence
</span><span class="sc0">        </span><span class="sc2">// is sequence
</span><span class="sc0">        
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">keys</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//return a list contains the keys of a dict
</span><span class="sc0">                </span><span class="sc11">assert</span><span class="sc10">(</span><span class="sc11">is_dict</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">values</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//return a list contains the values of a dict
</span><span class="sc0">                </span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc10">=*</span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">haskey</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">append</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">node</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//append a node to the end of a list
</span><span class="sc0">                </span><span class="sc2">// list&amp; l=lst();
</span><span class="sc0">                </span><span class="sc2">// l.push_back(node);
</span><span class="sc0">                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">extend</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">rlist</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc2">//extend a list with another list
</span><span class="sc0">                </span><span class="sc2">// list&amp; l=lst();
</span><span class="sc0">                </span><span class="sc2">//TODO
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">each</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc2">//for each
</span><span class="sc0">        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">foreach</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc2">// void map(UnaryFunction) {    id, val, }//for list
</span><span class="sc0">        
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">slice</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">add</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">dot</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
        
        
        
        
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc2">//useful functions
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">list</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">begin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">begin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">tuple</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">set</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">dict</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">var</span><span class="sc0"> </span><span class="sc11">sorted</span><span class="sc10">(</span><span class="sc11">var</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">var</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#endif </span><span class="sc1">/* PYPP_HPP_BY_JADESOUL */</span><span class="sc0">
</span></div></body>
</html>
